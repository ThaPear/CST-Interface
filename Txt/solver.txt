Home | Visual Basic (VBA) Language | 3D Simulation VBA | VBA Objects | Solver | High Frequency | Solver (HF)

Solver Object

This is the object that controls the high frequency solvers. A corresponding FDSolver Object allows to manipulate the settings for the Frequency Domain and Integral Equation solvers. The EigenmodeSolver Object is the specialized object for the calculation of Eigenmodes. Please note that the AKS Eigenmode solver method is still configured by the Solver Object.

Settings concerning a simulation run may be defined with this object. Use one of the 'start' commands to run the Time Domain Solver.

This object controls the Wakefield solver.

 

General

General Methods

Mesh

Queries

Defaults

Time Domain Solver Settings

Wakefield Solver Settings

General

Excitation

Symmetries

Waveguide Ports

Steady State

AR Filter / Time Window

Material Special Settings and Monitors

Mesh

MPI Computation

Defaults

Examples

Eigenmode Solver Settings

General

Queries

Defaults

 

General Methods

 

TimeBetweenUpdates ( int value )

Defines the time range between the plot window is updated during a simulation run.

 

FrequencyRange ( double fmin, double fmax )

Sets the frequency range for the simulation. Changing the frequency range has several side effects. The mesh will be changed and all previous simulation results will be deleted. However, before the frequency range is actually changed, a dialog window will appear that asks to save the old results to another file.

 

CalculateZandYMatrices

Starts the calculation for Z and Y matrices. The results will be displayed in the Navigation Tree.

 

CalculateVSWR

Starts the calculation for VSWR. The results will be displayed in the Navigation Tree.

 

%% Mesh

 

PBAFillLimit ( double percentage )

Defines when a cell should be treated as entirely filled with Perfectly Conducting Material (PEC). So if a cell is filled with more than percentage of the cell with PEC, the entire Cell will be filled with PEC. For other materials this setting has no effect. Generally, this setting should not be changed.

 

UseSplitComponents ( bool flag )

Specifies if the matrix calculation is performed using split components (flag = True) or not (flag = False).

 

EnableSubgridding  ( bool flag )

Enables the MSS" (Multilevel Subgridding Scheme).

 

AlwaysExludePec  ( bool flag )

This method offers the possibility to automatically exclude all PEC regions from the calculation. In case that large PEC regions exist this option may produce a significant speed-up of the simulation.

 

%% MPI Computation

 

MPIParallelization  ( bool flag )

Enable or disable MPI computation for solver.  

 

%% Queries

 

GetFmin double

Returns the minimum defined frequency.

 

GetFmax double

Returns the maximum defined frequency.

 

GetNFsamples int

Returns the total number of frequency points that are used to represent the scattering parameters.

 

GetNumberOfPorts int

Returns the number of defined Ports.

 

ArePortsSubsequentlyNamed bool

Inquires whether the ports are consecutively numbered or not. If they are, the total number of ports equals to the last port name. Otherwise the last name might be higher.

 

GetStimulationPort int

Returns -1, if ports = All, 0 if ports = Selected Ports and -2, if plane wave excitation is active.

 

GetStimulationMode int

Returns 0, if stimulation port is not a wave guide port, returns -1, if modes = All and if there is a wave guide port.

 

GetTotalSimulationTime long

Returns the total simulation time of a complete transient solver start, as the case may be including several port excitations.

 

GetMatrixCalculationTime long

Returns the running time of the matrix calculator.

 

GetLastSolverTime long

Returns the simulation time of the last performed solver run.

 

%% Time Domain Wakefield Solver General

 

Start int

Starts the Time Domain Simulation with the current settings and returns 1 if the calculation is successfully finished and 0 if it failed.

 

AutoNormImpedance ( bool flag )

S-Parameters are always normalized to a reference impedance. You may either select to norm them to the calculated impedance of the stimulation port or you may specify a number of your choice.  If flag is False the reference impedance will be the calculated impedance of the input port.

 

NormingImpedance ( double imped )

Specifies the impedance to be used as reference impedance for the scattering parameters. This setting will only be considered if AutoNormImpedance is set to True.

 

MeshAdaption ( bool flag )

If MeshAdaption is enabled (flag = True) several Simulation runs are started to automatically find the optimum mesh for the given Problem.

 

UseDistributedComputing ( bool flag )

If flag is set to True this method enables the distributed calculation of different solver runs across the network.

 

DistributeMatrixCalculation( bool flag )

If flag is set to True the matrix calculation is performed separately for each distributed solver run on the remote machines. Otherwise the matrix calculation is done only once on the machine where the frontend is running.

 

HardwareAcceleration ( bool flag )

If flag = true, hardware acceleration for the transient solver is activated. Please note, that a hardware acceleration card has to be inserted into your computer in order to profit from this setting.

 

StoreTDResultsInCache ( bool flag )

If flag is set to True this method stores results of the time domain solver in the result cache.

 

FrequencySamples ( int nSamples )

Defines the resolution of all frequency domain signals for the next simulation. This setting has no significant influence on the total simulation time. It only influences the Discrete Fourier Transform (DFT) that is used to transform the time domain signals into the frequency domain. nSamples will be the total number of frequency samples that the frequency domain signals will have.

 

FrequencyLogSamples ( int nSamples )

Defines the resolution of all frequency domain signals for the next simulation using a logarithmic sample distribution. This setting has no significant influence on the total simulation time. It only influences the Discrete Fourier Transform (DFT) that is used to transform the time domain signals into the frequency domain. nSamples will be the total number of logarithmically distributed frequency samples that the frequency domain signals will have.

 

ConsiderTwoPortReciprocity ( bool flag )

If flag is set to False, a simulation for every port is performed in order to get the scattering parameter matrix. Otherwise, for reciprocal (loss free two port) systems only one simulation will be made.

 

EnergyBalanceLimit ( double limit )

Method for the two-port-reciprocity functionality (ConsiderTwoPortReciprocity method) to determine whether or not the structure is loss free. This determination is done by checking the energy balance. For reciprocal and loss free structures the energy balance should be one. If the simulated balance differs to one for lower than the given limit over the whole frequency range the structure is assumed to be loss free.

 

TimeStepStabilityFactor ( double value )

Specifies a stability factor that is multiplied to the current valid time step. Note: Normally the current time step is matched to the stability limit, thus factor values greater than 1 may make the time domain simulation unstable.

 

NormalizeToReferenceSignal( bool flag )

In case of the default Gaussian excitation signal, which is predefined in CST MICROWAVE STUDIO, all frequency results of the transient solver are automatically normalized to the spectrum of this default signal in order to provide consistent broadband results, independent of the transient excitation signal. This allows convenient comparisons to e.g. frequency domain solver results.

However, selecting other signals for excitation, e.g. a rectangular pulse or an imported signal, this normalization step is not done by default. This means that in these cases all frequency results are purely represented by the unnormalized discrete Fourier transformation of the correspondent  transient data. In any case, you can still apply a normalization step to the selected reference signal in CST MICROWAVE STUDIO by enabling this check button, independent whether this signal is actually used or not. As mentioned above, changing this button has no influence when the default Gaussian excitation signal is used. The normalization to the default signal can be changed by using the command NormalizeToDefaultSignalWhenInUse.

In case of a transient co-simulation run, usually the excitation is driven from within CST DESIGN STUDIO. Consequently also the result normalization can be controlled here, either normalizing to a Gaussian reference signal or not. This can be defined for each task separately and consistently effects both, the frequency domain results in CST  MICROWAVE STUDIO as well as in CST DESIGN STUDIO.

 

NormalizeToDefaultSignalWhenInUse ( bool flag )

In case of the default gaussian excitation signal, which is always predefined in CST MICROWAVE STUDIO, all frequency results of the transient solver are automatically normalized to the spectrum of this default signal in order to provide consistent broadband results, independent of the transient excitation signal. This allows convenient comparisons to e.g. frequency domain solver results. This behavior can be changed by calling this command with flag = false, then all frequency results are purely represented by the unnormalized discrete Fourier transformation of the correspondent transient data. Please note that this command has no influence when the default signal is not in usage for excitation.

 

AutoDetectIdenticalPorts ( bool flag )

If flag = true, the geometry and settings of waveguide ports are compared. Identical ports are clustered in order to skip repeated line impedance adaptation runs. If identical ports are found, line impedance adaptation runs will be done for one reference port per cluster only.

 

AutomaticTimeSignalSampling ( bool flag )

If flag = true, the transient solver automatically samples all time signals that are written to disk to reduce the data amount while still fulfilling the sampling theorem. By deactivating this automatic functionality the signals are written with highest possible sampling rate, i.e. every timestep.

 

ConsiderExcitationForFreqSamplingRate ( bool flag )

The transient solver automatically determines a downsampling factor for the frequency domain result evaluation. This enables reducing the computation effort and data processing amount for all the computed results and active features. The downsampling factor will be determined to fulfill the sampling theorem.

If flag = false the considered maximum frequency for the sampling theorem is the one selected with the FrequencyRange method. If flag = true an estimation of the maximum frequency of the excitation signals is also used to improve the downsampling factor. This is particularly appropriate in correspondence of digital signals which produce high frequency components - possibly not completely resolved or affected by aliasing - even if at the cost of a higher sampling rate, up to every timestep.

 

TDRComputation( bool flag )

If the flag is set to true, the transient solver performs an online TDR analysis for step or Gaussian excitation signals and adds the corresponding signal curve into the result tree. The TDR calculation is applied for single port excitations of discrete ports or waveguide ports with (Q)TEM modes.

 

TDRShift50Percent( bool flag )

This command allows  the shift of the online TDR response in time: The TDR plot then starts at t=0, when the input pulse for the TDR computation reached 50% of its maximum.

 

TDRReflection( bool flag )

If the flag is set to true, the solver calculates the reflection factor over time instead of the time domain reflectometry (TDR). The reflection factor is bound between -1 and +1. Therefore even for an open transmission line, the reflection factor stays within these limits – in contrast to the TDR, which is infinite in this case. The reflection factor is also useful, if the structure needs to be optimized, hence the reflection minimized.

 

UseBroadBandPhaseShift ( bool flag )

If the flag is set to true, the phase shift defined either for a simultaneous excitation or for a circular/elliptical plane wave excitation will be considered as a broadband behavior, respectively.

 

SetBroadBandPhaseShiftLowerBound ( double value )

Method for the broadband phase shift functionality defined either for a simultaneous excitation or for a circular/elliptical plane wave excitation (UseBroadBandPhaseShift).

The broadband phase shift filter is computed by means of an Hilbert filter which guarantees accurate results in the frequency range [ lower bound factor * fMax, fMax ] where fMax is the upper simulation frequency range. Reducing the lower bound factor allows to enlarge the accuracy frequency range at the expense of higher complexity and computational costs for the filter evaluation.  

 

SParaAdjustment ( bool flag )

Disable this functionality to receive pure S-parameter results without any passivity adjustment.

 

PrepareFarfields ( bool flag )

All farfield results are automatically precalculated to speed up the post-processing.

 

MonitorFarFieldsNearToModel ( bool flag )

All farfield results are computed and evaluated on a box close to the structure instead of on the global simulation bounding box. This reduces the numerical dispersion due to the integration of the electric and magnetic field and increases the results accuracy. The command applies to the farfield (and RCS) probes and to all non-subvolume defined farfield monitors.

 

MatrixDump ( bool flag )

If flag = true, all solver relevant matrices are dumped to file.

 

RestartAfterInstabilityAbort ( bool flag )

If flag = true, the transient solver is automatically restarted twice with a reduced timestep after an instability abort. In case that the occurred instability is due to the time discretization, this process helps to provide a stable simulation during the restarted run.

 

MaximumNumberOfThreads ( int number )

Define the maximum number of parallel threads to be used for the transient solver run.

 

SetPMLType ( enum {"ConvPML", "GTPML"} key )

Define the PML formulation type. Allowed algorithms are ConvPML for the Convolution PML or GTPML for the Generalized PML theory.

 

DiscreteItemUpdate ( enum {"Gap", "Distributed"} key )

Define the update schema for the discrete items, i.e. discrete ports and lumped elements, to be used by the transient solver run.

Selecting the Gap schema (default choice) the discrete face element will be modeled as a PEC (perfectly electric conductor) sheet except for a small gap where the source excitation is imprinted and the load impedance is located. A similar modeling applies to the discrete edge element where the source/load is located in the middle of a PEC wire.

Selecting the Distributed schema (preview choice) models the source and load as distributed over the entire surface of the face (entire length of the wire, respectively) providing a more robust representation as well as supporting coaxial face elements and also discrete current face ports.

The method DiscreteItemUpdate applies the update schema both to the edge and to the face discrete ports and lumped elements. The method DiscreteItemEdgeUpdate and DiscreteItemFaceUpdate applies the update schema only to the edge and face discrete elements, respectively.

 

DiscreteItemEdgeUpdate ( enum {"Gap", "Distributed"} key )

See DiscreteItemUpdate for details.

 

DiscreteItemFaceUpdate ( enum {"Gap", "Distributed"} key )

See DiscreteItemUpdate for details.

 

SuppressTimeSignalStorage ( enum {"True"/"All", "False"/"None"/"Reset", "Ports", "LumpedElements", "Probes", "UIMonitors"} key  )

Selects the mode to be used for the suppression of writing time signals into the storage database. When a signal is not written into the storage database, no entry is added to the result Navigation Tree.

The parameter key may have one of the following values:

True / All

All signals will be suppressed, i.e. no signals are written to database.

False / None / Reset

No signals will be suppressed, i.e. all signals will be written to database. This is the default setting.

Ports

All port signals are suppressed, i.e. all in- and outgoing signals for all port types as well as the monitored voltage and current of discrete ports.

LumpedElements

The monitored voltage and current of lumped elements will be suppressed.

Probes

All probe signals will be suppressed. This holds for near- as well as for farfield probes.

UIMonitors

All 1D voltage and current monitors are suppressed.

Time Domain Solver Excitation

CalculateModesOnly ( bool flag )

If flag is True, the solver calculates only the port modes.

 

StimulationMode ( int key )

Selects the mode to be used for excitation.

 

The parameter key may have one of the following values:

All

All modes will be excited once.

int modeNumber

The mode number to be used for excitation.

 

StimulationPort ( int key )

Selects the port(s)  to be used for excitation.

The parameter key may have one of the following values:

All

All ports will be excited once.

Selected

Only those ports / modes are used for excitation that have been set by ExcitationPortMode.

"Plane Wave"

A plane wave will be used for excitation.

int portNumber

The port number (port name) to be used for excitation.

 

ResetExcitationModes

Resets the complete excitation list, which was previously defined by applying methods ExcitationPortMode or ExcitationCurrentDistribution.

 

ExcitationPortMode ( int port, int mode, double ampli, double phase_or_time, name signal, bool flag )

Defines the excitation signal signal that is used to excite the port mode mode at the port port. The excitation signal must be defined previously. The signal curve is modified due to the defined ampli and phase/time values, describing the amplitude and the time shift of the excitation. The latter can be defined as a time shift or a phase shift, using the SetSimultaneousExcitationOffset method. The boolean argument flag activates the time shift definition.

Note: If signal = "default", the chosen reference signal is used for excitation. MWS offers an Excitation Signal Library where different time signals can be chosen from. Time signals other than "default" can be chosen only if SimultaneousExcitation is set to True.

 

ExcitationCurrentDistribution  ( int name, double ampli, double phase_or_time, name signal, bool flag )

Defines an excitation for simultaneous or selected simulation, either applied to a port mode or a current distribution. The parameters port/mode or name, respectively, define the excitation source (port/mode or current distribution) to be used.

The selected excitation will be modulated by a time signal of name signal., that has to be defined previously. This signal curve is modified due to the defined ampli and phase/time values, describing the amplitude and the time shift of the excitation. The latter is either based on a time shift or a phase shift definition, depending on the selection of the SetSimultaneousExcitationOffset method. The boolean argument flag activates this excitation definition for the next simulation.

Note: If signal = "default", the chosen reference signal is used for excitation.

MWS offers an Excitation Signal Library where different time signals can be chosen from.

Time signals other than "default" can be chosen only if SimultaneousExcitation is set to True.

 

DefineExcitationSettings  (enum key {"portmode", "fieldsource"},  int name, int mode, double ampli, double phase_or_time, name signal,  double accuracy,  double fmin,  double fmax, bool flag )

Similar to the VBA methods above, this method also allows different specifications of excitation settings for different ports/fieldsources. In addition to the amplitude, the phase/time delay and the signal definition, here you have also the possibility to define accuracy as well as a frequency interval for field monitoring.

A specific accuracy value can be defined to overwrite the default value which is given on the solver dialog page. This option allows different solver runs (port excitations) with a different level of accuracy, what is useful for example to consider certain EMC standards.

In addition an individual frequency range can be entered per excitation (fmin and fmax), defining the valid interval for evaluating frequency based field monitors. This means that any defined field monitor is only evaluated and stored when its frequency is inside the mentioned interval, otherwise it is ignored. This helps saving time and disk space in case for example of multiband antenna setups. Using the default setting will again consider all monitors inside the global frequency interval.

Please note, that both settings are only available for sequential excitation, i.e. they will be ignored in case simultaneous excitation is selected.

 

PhaseRefFrequency ( double value )

The phase values defined in the excitation list are converted into corresponding time shifts for the time signals by use of this reference frequency. If the reference frequency is set to '0', time shift instead of phase shift is activated. (see ExcitationPortMode Method)

 

SParameterPortExcitation  ( bool flag )

If no simultaneous excitation is selected (see command SimultaneousExcitation), this options allows changing the behavior of the sequential excitation processing of the selected ports/sources (see command ExcitationPortMode). Enabling this option calculates standard S-Parameter results with fixed amplitude and signal settings, while disabling allows the simulation of each port/source independently with arbitrary amplitude and signal settings leading to so-called F-parameters.

 

SimultaneousExcitation ( bool flag )

Enables simultaneaous excitation.

 

SetSimultaneousExcitAutoLabel ( bool flag )

If a set of excitations has been defined for one simultaneous excitation run, an automatically generated label (as a prefix) is used to name the signals produced by the simulation. Use this method to activate this automatic labeling.

 

SetSimultaneousExcitationLabel ( name label )

If the SetSimultaneousExcitAutoLabel method is disabled, it is possible to manually define a prefix name for the signals produced by simultaneous excitation run.

 

SetSimultaneousExcitationOffset ( enum key )

This method determines the time shift definition between different time signals applied for simultaneous excitation.

The parameter key may have one of the following values:

"Timeshift"     The time shift value defined with the ExcitationPortMode method is directly used to shift the signals in time.

"Phaseshift"    The phase shift value defined with the ExcitationPortMode method is transferred in a time shift value using the phase reference frequency (PhaseRefFrequency method). This value is then used to shift the signals in time.

 

ExcitationSelectionShowAdditionalSettings ( bool flag )

Setting the flag as active makes visible some more excitation settings in the Excitation Selection dialog.

These settings are only available for sequential excitation, i.e. they will be ignored in case simultaneous excitation is selected. A specific Accuracy value can be defined to overwrite the global default value. In addition an individual frequency range can be entered per excitation (by setting Min. and Max. Monitor Frequencies), defining the valid interval for evaluating frequency based field monitors.

 

SuperimposePLWExcitation ( bool flag )

This method enables the superimposed stimulation of a previously defined plane wave in addition to a usual S-Parameter calculation. As excitation source type one or more port modes are selected using the StimulationPort and StimulationMode methods and the plane wave excitation is then applied in addition without producing any plane wave specific output files. Consequently the energy contribution of the plane wave excited into the calculation domain influences the S-Parameter and balance results possibly showing some active behavior. Please note that the default reference signal is used for exciting the plane wave.

 

ShowExcitationListAccuracy ( bool flag )

This method shows the correspondent entry fields for the definition of the solver accuracy in the solver excitation selection  dialog.

 

ShowExcitationListMonitorFreqInterval ( bool flag )

This method shows the correspondent entry fields for the definition of the monitor frequency range in the solver excitation selection  dialog.

 

%% Time Domain Solver S-Parameter Symmetries

 

SParaSymmetry ( bool flag )

Use s-parameter symmetries.

 

ResetSParaSymm

Resets all previously defined s-parameter symmetries.

 

DefSParaSymm

Defines a new set of S-parameter symmetries. Each call to SPara adds S-parameters to the set of S-parameter symmetries defined using this method. For this set all S-parameters are considered to be equivalent. You have to call this method at least once before calling SPara. See also the example for S-parameter symmetry setup.

 

SPara ( int portNo1, int portNo2 )

Adds an S-parameter defined by a pair of ports to the symmetry set that was defined in advance by a call of DefSParaSymm. This S-parameter is equal to all S-parameters of the same symmetry set defined by previous calls to SPara . The definition of the two involved port numbers should be enclosed in quotation marks (" "). See also the example for S-parameter symmetry setup.

 

%% Time Domain Solver Waveguide Ports

 

WaveguidePortGeneralized( bool flag )

Switches the port mode solver type between generalized (on) or standard (off).

 

WaveguidePortModeTracking( bool flag )

Activates the mode tracking. This is optional for the generalized port mode solver. If the standard port mode solver is selected this setting is ignored.

 

AbsorbUnconsideredModeFields( enum key )

This option indicates whether unconsidered mode fields occurring at the waveguide ports should be absorbed by a Mur open boundary. These fields can be given by slight field errors due to inhomogeneous ports (the non-broadband waveguide port operators work less accurately with increasing distance from the mode calculation frequency) or by higher order modes which are not considered by the port operator.

"Automatic"     When selecting this option the absorption is only active for inhomogeneous ports.

"Activate"      When selecting this option the absorption is always activated.

"Deactivate"    When selecting this option the absorption is always deactivated.

 

FullDeembedding ( bool flag )

Set flag to True to perform a calculation with inhomogeneous port accuracy enhancement ("full deembedding"). This implies that the source type is set automatically to All ports / All modes. If some inhomogeneous ports occur in the structure the port modes will be calculated with broadband information which is added to the result tree. After all solver runs have finished the complete S-parameter matrix is generated considering the broadband behavior of the port modes. The number of frequency samples for this procedure can be defined in the special solver settings/waveguide. For more detailed information see the waveguide port overview.

 

SetSamplesFullDeembedding ( int nSamples )

Sets the number of frequency samples for calculations with inhomogeneous port accuracy enhancement (FullDeembedding).

 

DispEpsFullDeembedding ( bool flag )

Consider the dispersive behavior of the permittivity in port materials (real and imaginary part) for calculations with inhomogeneous port accuracy enhancement. This setting is only considered for the standard port mode solver. The generalized port mode solver always considers the electric or magnetic dispersive materials in calculations with inhomogeneous port accuracy enhancement.

 

SetModeFreqFactor ( double value )

Specifies the frequency that is used for the waveguide port mode calculation. The factor is set relatively to the current frequency range. Therefore value may range between 0 and 1.

 

ScaleTETMModeToCenterFrequency ( bool flag )

Enabling this option will scale any TE/TM mode excitation to the center frequency of the globally defined frequency range. The mode pattern of a TE/TM mode is analytically known over the whole frequency band and the power normalization of the mode amplitude can either be done at the mode evaluation frequency or at the center frequency. The latter is activated by default to always ensure the same time signal imprint, independent of the selected mode evaluation frequency. Consequently, if this option is disabled, the port signals will change when adjusting the mode evaluation frequency.

Please note, that all frequency results (1D signals or field monitors) are in any case normalized to a constant value over the frequency band, i.e. the correct TE/TM scaling is considered for every evaluated frequency point.

 

SetVoltageWaveguidePort( int portname, double value, bool flag)

This command applies a pure voltage excitation to the waveguide port with the name portname. The voltage value defines the amplitude of the excitation. Please note that this special excitation is only valid for the basic (Q)TEM mode of a two-conductor port. With the flag you can enable or disable again this special treatment.

 

AdaptivePortMeshing ( bool flag )

Activates the adaptive port meshing feature to automatically calculate a more accurate line impedance and mode pattern. For this purpose the port mode solver runs several passes while adaptively refining the port mesh.

 

AccuracyAdaptivePortMeshing ( int nPercent )

Represents an accuracy limit for the relative error of the line impedance. The adaptive port meshing is finished when the line impedance has not changed more than this percentage value for two following passes or the maximum number of passes is reached.

 

PassesAdaptivePortMeshing ( int nPasses )

Restricts the number of passes in the adaptive port meshing if the port line impedance takes too long to converge.

 

%% Time Domain Solver Steady State

 

NumberOfPulseWidths ( int nPulses )

Limits the maximum simulation time. This setting should not be used to stop the simulation generally. By default the steady state monitor should stop it before the maximum simulation time is reached. If the simulation is stopped before the steady state monitors stop it, the calculated scattering parameters will be incorrect. The pulse width is directly related to the chosen frequency range. It is defined by the Gaussian pulse that is used for a default broadband time domain simulation.

 

SteadyStateLimit ( enum key )

This setting defines the steady state monitor. It influences the duration of the simulation. It is a value for the accuracy of the frequency domain signals that are calculated by Fourier Transformation of the time signals.

This setting has to be understood only in connection with the processing of the time signals. Errors made by discretising a structure can only be influenced by manipulating the mesh.

Every simulation stops at some time. This means, that the signals that are calculated are truncated at this point, regardless to their values. If these values are non zero the Fourier Transformation will produce an error, because only a part of the whole signal with all its non zero values has been used for the transformation. So the smaller the signals are, the more accurate the frequency domain values will be. To get a value for the accuracy not the signal amplitudes itself are used, but the total energy inside of the calculation domain. During the simulation the energy is frequently calculated and related to the maximum energy that has been monitored. This value in a logarithmic scale defines the accuracy.

The parameter key may have one of the following representation:

"accuracy_dB"   where accuracy_dB is an integer value (in dB unit) for the steady state monitor. It must belong to the interval [-80 , 0] dB.

"No Check"      The steady state monitor is disabled. If no additional stop criteria are defined by means of the method AddStopCriterion the simulation stops after the defined NumberOfPulseWidths.

 

 

%% With the following commands it is possible to define customized stop rules in addition to the energy criteria specified by the .SteadyStateLimit command. A combination of S-parameter, probe or radiated power convergence criteria is available. For more details on the error evaluation formula please refer to the Steady State help page.

RemoveAllStopCriteria

Resets all previously defined solver custom stop criteria, i.e. no custom stop rule will be active and in use.

 

AddStopCriterion( name GroupName, double Threshold, int Checks, bool Active )

Adds a specific solver custom stop criterion measuring the deviation of the results (S-parameters, probes and radiated power) in subsequent time steps.

The parameter GroupName specifies the items to be checked for the stop rule. Each group is declared and fully described in the Steady State tab of the Special Time Domain Solver Parameters dialog. A number of predefined group names is available:

All S-Parameters - the stop criteria is based on the convergence of all available S- and F-parameters.

Transmission S-Parameters - the stop criteria is based on the convergence of all available transmission S- and F-parameters.

Reflection S-Parameters - the stop criteria is based on the convergence of all available reflection S- and F-parameters.

All Probes - the stop criteria is based on the convergence of all near and far field probe frequency spectra.

All Radiated Powers - the stop criteria is based on the convergence of the radiated power extracted from all farfield/RCS (Frequency and Transient Broadband) monitors.

The parameter Threshold sets the accuracy (in linear scale) to be used for the convergence test. A value between 0.0 and 1.0 is required.

The parameter Checks sets the number of consecutive error samples which should drop below the threshold to consider the convergence criterion as being met and stop the solver. A value greater than 0 is required.

The parameter Active enables or disables the stop criterion.

 

StopCriteriaShowExcitation ( bool flag )

Controls if the generation of the custom stop criteria should take into account also the excitation information.

If the flag is active the available group items are shown in the Convergence Criteria Selection dialog in combination with the excitation information. This enables the test of the group items for the specified excitation only. If the flag is inactive the items are shown in the dialog simply by their name and they will be tested independently of the current excitation. This option applies to the definition of new probe or radiated power groups only.

 

%% Time Domain Solver AR Filter / Time Window

 

UseArfilter ( bool flag )

The Auto Regressive (AR)-filter is a signal processing method to predict time signals to save simulation time. These predicted signals are then used to calculate the scattering matrices. AR-filtering should be used when simulating very resonant structures.

By this function the AR-filter analysis during the time domain calculation can be switched on or off.

If an AR-Filter is calculated during the simulation a energy balance from the extrapolated signals is calculated as well. If this energy balance reaches one within a specified limit faster than the EnergyBalanceLimit, it stops the simulation.

 

ArMaxEnergyDeviation ( double limit )

If the calculation of AR-Filters is switched on, for every Signal an AR-Filter is determined independently. As an indicator of how accurate these predictions have been, the energy balance depending on these AR-Filter signals is calculated. This balance is compared to the energy balance for normal scattering parameters for loss free, reciprocal structures, which is one. The difference between these two signal is taken as a value for the accuracy of the AR-Filter signals.

The value that can be set by ArMaxEnergyDeviation defines a limit for the accuracy of the AR-Filter signals. If the accuracy has been reached the simulation will be stopped.

 

ArPulseSkip ( int nPulses )

Defines the number of impulses that will not be considered by the AR-filter. A pulse width is directly related to the Gaussian pulse used for excitation by default.

 

StartArFilter

Starts the AR-filter.

 

SetTimeWindow ( enum key, int smoothness, bool flag )

Because every simulation should only take finite time the resulting time signals can be thought of a multiplication by the imaginary infinite time signal and a time windowing function. In the simplest case this is a rectangular window. However rectangular windows cause the resulting frequency domain signals to be quite rough. They become smoother if cosine shaped windows are used. However in cases of steep resonance peaks these functions may broaden these peaks. The parameter smoothness is the decay time in percent of the total signal time (0 % = rectangular window / 100 % = ideal cosine window). The flag switches the time window during a transient simulation on/off .

The parameter key may have one of the following values:

Rectangular Selects a rectangular time window.

Cosine      Selects a cosine shaped time window.

 

%% Time Domain Solver Material Special Settings and Monitors

 

SurfaceImpedanceOrder ( int order )

Specifies the order of the one dimensional surface impedance model. In case that the model order is increased the simulation result is enhanced at the expense of a higher calculation effort.

 

ActivatePowerLoss1DMonitor ( bool flag )

Activates the computation of the power dissipated by the dispersive electric and magnetic materials and by the lossy metal, surface impedance (i.e. ohmic sheet, tabulated surface impedance and corrugated wall) and compact model elements (i.e. thin panel).

A 1D curve displaying the overall power dissipated by these elements as a function of frequency is computed and displayed in the "1D Results" tree subfolder.

The user can select  the frequencies where the dissipated power has to be computed and therefore control the source contribution, i.e. in correspondence of the defined 3D field frequency monitors, of the defined far field monitors or of additional selected frequencies. The commands Use3DFieldMonitorForPowerLoss1DMonitor, UseFarFieldMonitorForPowerLoss1DMonitor and UseExtraFreqForPowerLoss1DMonitor configure this choice.

The information provided by the dissipated power curve offers a better insight into the model power efficiency and allows an accurate energy balance evaluation.

 

PowerLoss1DMonitorPerSolid ( bool flag )

Includes a subfolder containing the power dissipated by the dispersive electric and magnetic materials and the lossy metal, surface impedance and compact model elements sorted by solids.

 

Use3DFieldMonitorForPowerLoss1DMonitor ( bool flag )

Activates the computation of the power dissipated by the dispersive electric and magnetic materials and the lossy metal, surface impedance and compact model elements in correspondence of the defined 3D field frequency monitors.

The computation of the dispersive electric and magnetic material losses will be performed summing up the contribution of those fields monitor only. This is especially important when subvolume field monitors are defined as the losses are computed in the corresponding subvolume only.

The computation of the lossy metal, surface impedance and compact model losses will be anyway performed summing up the contributions in the entire simulation domain.

 

UseFarFieldMonitorForPowerLoss1DMonitor ( bool flag )

Activates the computation of the power dissipated by the dispersive electric and magnetic materials and the lossy metal, surface impedance and compact model elements in correspondence of the defined far field monitor frequencies. The computation of the material losses will be performed summing up the contributions in the entire simulation domain. To this purpose internal monitors will be generated on the entire domain at the far field monitor frequencies. Take into account that this requires additional memory resulting in a significant effort in case of multiple far field monitor definition.

 

UseExtraFreqForPowerLoss1DMonitor ( bool flag )

Activates the computation of the power dissipated by the dispersive electric and magnetic materials and the lossy metal, surface impedance and compact model elements in correspondence of the  frequencies defined by means of the AddPowerLoss1DMonitorExtraFreq command. The computation of the material losses will be performed summing up the contributions in the entire simulation domain. To this purpose internal monitors will be generated on the entire domain at the required frequencies. Take into account that this requires additional memory resulting in a significant effort in case of multiple frequency definition.

 

ResetPowerLoss1DMonitorExtraFreq

Reset the list of the additional frequency values where the monitors for the power dissipated by the dispersive electric and magnetic materials and the lossy metal, surface impedance and compact model elements are calculated.

 

AddPowerLoss1DMonitorExtraFreq ( double freq )

Activates the computation of the power dissipated by the dispersive electric and magnetic materials, the lossy metal, surface impedance (i.e. ohmic sheet, tabulated surface impedance and corrugated wall) and compact model elements (i.e. thin panel) at the provided frequency value.

 

SetTimePowerLossSIMaterialMonitor ( bool flag )

Activates the computation of the time domain 1D monitor for the power dissipated by the lossy metal and broadband surface impedance elements (i.e. ohmic sheet, tabulated surface impedance and corrugated wall). A 1D curve displaying the overall power dissipated by these elements as a function of time is computed and displayed in the "1D Results" tree subfolder.

 

ActivateTimePowerLossSIMaterialMonitor ( double TStart , double TStep , double TEnd , bool UseTEnd )

Define the parameters for the powerloss time domain 1D monitor for the surface impedance material. In details TStart is the start time for the time monitoring. TStep is the desired step width for the time monitoring. Together with start and end time this value determines the full number of recorded time samples. If the flag UseTEnd is true then TEnd specifies the ending time for the recording, otherwise the recording will continue up to the end of the calculation.

 

SetTimePowerLossSIMaterialMonitorAverage ( bool flag )

Setting flag to true allows the calculation of averaged values over time for a powerloss time domain 1D monitor for the surface impedance material. By default the monitor is integrated over time and averaged by its number of sample steps. The duration and sample step of the integration is defined by setting the values TStart, TStep, TEnd and UseTend. However, with the command SetTimePowerLossSIMaterialMonitorAverageRepPeriod it is possible to define a specific time interval to normalize the monitor result.

 

SetTimePowerLossSIMaterialMonitorAverageRepPeriod ( double TimePeriod )

The value TimePeriod defines the time interval which is used for normalization of the averaged powerloss time domain 1D monitor for the surface impedance material (activated by the command SetTimePowerLossSIMaterialMonitorAverage). In case this value is set to zero, the time interval of the monitor (defined by TStart, TStep, TEnd and UseTend) is used instead.

 

TimePowerLossSIMaterialMonitorPerSolid ( bool flag )

Includes a subfolder sorting the powerloss time domain 1D monitor for the surface impedance material by solids.

 

SetDispNonLinearMaterialMonitor ( bool flag )

Activates the computation of the plasma and nonlinear material monitor. In case of nonlinear plasma material the charge density will be recorded. In case of dispersive nonlinear material the instantaneous equivalent eps and mu variation due to the nonlinearity will be recorded.

 

ActivateDispNonLinearMaterialMonitor ( double TStart , double TStep , double TEnd , bool UseTEnd )

Define the parameters for the time domain plasma and nonlinear material monitor. In details TStart is the start time for the time monitoring. TStep is the desired step width for the time monitoring. Together with start and end time this value determines the full number of recorded time samples. Note that time monitors possibly need a great amount of disk memory if the step width is chosen too small. If the flag UseTEnd is true then TEnd specifies the ending time for the recording, otherwise the recording will continue up to the end of the calculation.

 

ActivateSpaceMaterial3DMonitor( bool flag )

Activates the computation of the space material monitor (3D) recording information on the complex permeability and permittivity for the dispersive space map based materials at a given frequency.

The user can select  the frequencies where the monitor has to be computed and therefore control the source contribution, i.e. in correspondence of the defined 3D field frequency monitors or of additional selected frequencies. The commands Use3DFieldMonitorForSpaceMaterial3DMonitor and UseExtraFreqForSpaceMaterial3DMonitor configure this choice.

 

Use3DFieldMonitorForSpaceMaterial3DMonitor( bool flag )

Activates the computation of the space material monitor (3D) in correspondence of the frequencies of the defined 3D field frequency monitors.

 

UseExtraFreqForSpaceMaterial3DMonitor( bool flag )

Activates the computation of the space material monitor (3D) in correspondence of the frequencies defined by means of the AddSpaceMaterial3DMonitorExtraFreq command.

 

ResetSpaceMaterial3DMonitorExtraFreq

Reset the list of the additional frequency values where the space material monitors (3D) are calculated.

 

AddSpaceMaterial3DMonitorExtraFreq( double freq )

Activates the computation of the space material monitor (3D) at the provided frequency value.

 

SetHFTDDispUpdateScheme (enum {"Standard", "Generalized"} key)

Controls how dispersive materials are discretized and simulated by the transient solver. A "Generalized" algorithm is available which provides, in case of highly resonant material models, increased accuracy, robustness and stability over the "Standard" algorithm.

 

%% Time Domain Solver Mesh

 

UseTSTAtPort ( bool flag )

Specifies if TST is used in the port region of a waveguide port (flag = True) or not (flag = False).  

 

SetSubcycleState (enum key {"Automatic", "Activate", "Deactivate"} )

Controls the allowance of subcycles concerning the time step calculation of the time domain algorithm.

 

SetSubgridCycleState (enum key {"Automatic", "Activate", "Deactivate"} )

In case that the Multilevel Subgridding Scheme is activated this command controls the allowance of subgrid specific cycling concerning the time step calculation of the time domain algorithm. If selected automatically or by user the different grid levels are calculated with different time steps.

 

SimplifiedPBAMethod ( bool flag )

This method activates a simplified PBA formulation for the transient simulation without any timestep reduction or usage of subcycled updates. This advantage is gained by a slight loss of accuracy and decrease of convergence.

 

%% Eigenmode Solver General

 

AKSPenaltyFactor ( double value )

Sets a scaling factor, in order to avoid static solutions within the calculated spectrum. Usually this parameter is set to 1.0. Increasing this number (up to 10.0) leads to a longer simulation time, because more matrix vector multiplications are necessary.

 

AKSEstimation ( double estim )

Sets the estimation for the (p+1)th resonance frequency, when p modes have to be calculated by the AKS solver. If the estimation factor is set to 0.0 the solver will do an automatic estimation, which is based on the bounding boxs dimensions.

 

AKSIterations ( int nIter )

Sets the number of iterations for the eigenmode solver.

 

AKSAccuracy ( double acc )

Sets the desired accuracy of modes, calculated by the eigenmode-solver.

 

AKSReset

Resets the AKS solver settings to its default values.

 

AKSStart

Starts  the eigenmode calculation solver.

 

AKSEstimationCycles ( int nIter )

In case that the given accuracy limit for the AKS calculation is not achieved, the iteration will be repeated. This method specifies the number of repetition cycles that will be performed during the calculation.

 

AKSAutomaticEstimation ( bool flag )

Enable automatic estimation for AKS.

 

AKSCheckModes ( int nModes )

The number of eigenmodes used for the frequency converge check.

 

AKSMaximumDF ( double err )

The convergence error (Delta F) is determined as the maximum variation of the eigenmode frequencies between two subsequent passes.

 

AKSMaximumPasses ( int nModes )

This setting determines the maximum number of passes to be performed for the mesh adaption, even if the eigenmode frequencies have not sufficiently converged so far. This setting is useful to limit the total calculation time to reasonable amounts.

 

AKSMeshIncrement ( int inc )

This parameter determines the changing of the mesh expert system by

increasing the settings of Lines per wavelength and Lower mesh limit in the Mesh Properties dialog box.

 

AKSMinimumPasses ( int minPass )

The minimum number of passes which will be performed, even if the eigenmode frequencies do not change significantly.

 

%% Eigenmode Queries

 

AKSGetNumberOfModes int

Returns the number of defined modes.

 

Default Settings

% Solve Defaults

PBAFillLimit (99)

UseSplitComponents (True)

TimeBetweenUpdates (20)

SParaAdjustment (True)

PrepareFarfields (True)

% Time Domain Solver Defaults

AutoNormImpedance (False)

NormingImpedance (50.0)

MeshAdaption (False)

UseDistributedComputing (False)

StoreTDResultsInCache (False)

ConsiderTwoPortReciprocity (True)

EnergyBalanceLimit (0.03)

TimeStepStabilityFactor (1.0)

AutomaticTimeSignalSampling (True)

UseBroadBandPhaseShift (False)

SParaAdjustment (True)

PrepareFarfields (True)

CalculateModesOnly (False)

StimulationMode (1)

WaveguidePortGeneralized (True)

WaveguidePortModeTracking (False)

AbsorbUnconsideredModeFields ("Automatic")

FullDeembedding (False)

SetSamplesFullDeembedding (20)

SetModeFreqFactor (0.5)

ScaleTETMModeToCenterFrequency (True)

AdaptivePortMeshing (True)

AccuracyAdaptivePortMeshing (1)

PassesAdaptivePortMeshing (4)

NumberOfPulseWidths (20)

SteadyStateLimit ("-30")

UseArfilter (False)

ArMaxEnergyDeviation (0.1)

ArPulseSkip (1)

SetTimeWindow ("Rectangular", 100, False)

SurfaceImpedanceOrder (10)

ActivateSIPowerLossyMonitor (False)

SetBurningPlasmaDensityMonitor (False)

TimestepReduction (0.45)

UseTSTAtPort (True)

SetSubcycleState ("Automatic")

NumberOfSubcycles (4)

SubcycleFillLimit (70)

EnableSubgridding (False)

SetSubgridCycleState ("Automatic")

SimplifiedPBAMethod (False)

SetSimultaneousExcitAutoLabel (True)

SetSimultaneousExcitationOffset ("Phaseshift")

AlwaysExludePec (False)

RestartAfterInstabilityAbort (True)

HardwareAcceleration (False)

MPIParallelization (False)

SetPMLType ("ConvPML")

NormalizeToReferenceSignal (False)

NormalizeToDefaultSignalWhenInUse (True)

TDRComputation (False)

TDRShift50Percent (False)

TDRReflection (False)

% Eigenmode Solver Defaults

AKSPenaltyFactor (1.0)

AKSEstimation (0.0)

AKSIterations (2)

AKSAccuracy (1e-6)

AKSNFsamples (1001)

AKSEstimationCycles (2)

AKSAutomaticEstimation (True)

AKSSpecDensitySamples (1)

AKSCheckModes (10)

AKSMaximumDF (0.01)

AKSMaximumPasses (6)

AKSMeshIncrement (5)

AKSMinimumPasses (2)

Examples

% Time Domain Solver

' User defined function that produces a sine of 30 MHz as excitation signal.

Option Explicit

Function ExcitationFunction(dtime As Double) As Double

ExcitationFunction = Sin(2*3.141*30*10^6*dtime)

End Function

 

' S-Parameter symmetry setup for a 3 port structure where all ports are symmetric to each other

With Solver

     .ResetSParaSymm

     .DefSParaSymm

     .SPara ("1, 1")

     .SPara ("2, 2")

     .SPara ("3, 3")

     .DefSParaSymm

     .SPara ("2, 1")

     .SPara ("3, 1")

     .SPara ("3, 2")

End With


